<?xml version="1.0" encoding="UTF-8"?>
<bpmn:definitions xmlns:bpmn="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:dc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" id="Definitions_1" targetNamespace="http://bpmn.io/schema/bpmn" exporter="Camunda Modeler" exporterVersion="2.0.3">
  <bpmn:process id="CallCustomerProcess" name="Call Customer Process" isExecutable="true">
    <bpmn:userTask id="UserTask_0c2b2p3" name="Call Customer #{ReasonForCall}" camunda:assignee="#{caller}" camunda:candidateGroups="#{team}">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="ReasonForCall" label="Call this customer because: " type="string">
            <camunda:validation>
              <camunda:constraint name="readonly" config="true" />
            </camunda:validation>
          </camunda:formField>
          <camunda:formField id="callSuccessful" label="Was the call successful" type="boolean" />
          <camunda:formField id="dateOfNextCall" label="Date of next call" type="date" />
          <camunda:formField id="decideNextTime" label="Do you need to auto generate next call time" type="boolean" />
          <camunda:formField id="callCustomerAgain" label="Do you want to call this customer again?" type="boolean" />
        </camunda:formData>
        <camunda:executionListener event="end">
          <camunda:script scriptFormat="javascript">var att = execution.getVariable('attemptsMade');
execution.setVariable('attemptsMade', att+1);</camunda:script>
        </camunda:executionListener>
      </bpmn:extensionElements>
      <bpmn:incoming>SequenceFlow_1ahh5de</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_02utn77</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_19iyyn4</bpmn:outgoing>
    </bpmn:userTask>
    <bpmn:exclusiveGateway id="ExclusiveGateway_0j3xqhl" name="Was call successful?">
      <bpmn:incoming>SequenceFlow_1rb16tp</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1wgbny4</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_0ehkhir</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_04erksu</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:intermediateCatchEvent id="IntermediateCatchEvent_0inwbfz" name="Next time for call">
      <bpmn:incoming>SequenceFlow_0ehkhir</bpmn:incoming>
      <bpmn:incoming>SequenceFlow_12qv5f6</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1ahh5de</bpmn:outgoing>
      <bpmn:timerEventDefinition>
        <bpmn:timeDate xsi:type="bpmn:tFormalExpression">#{dateOfNextCall}</bpmn:timeDate>
      </bpmn:timerEventDefinition>
    </bpmn:intermediateCatchEvent>
    <bpmn:businessRuleTask id="BusinessRuleTask_022wx0p" name="Decide on next call time" camunda:expression="#{true}">
      <bpmn:incoming>SequenceFlow_1wgbny4</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_12qv5f6</bpmn:outgoing>
    </bpmn:businessRuleTask>
    <bpmn:sequenceFlow id="SequenceFlow_1ahh5de" sourceRef="IntermediateCatchEvent_0inwbfz" targetRef="UserTask_0c2b2p3" />
    <bpmn:sequenceFlow id="SequenceFlow_19iyyn4" sourceRef="UserTask_0c2b2p3" targetRef="ExclusiveGateway_0dg8j7s" />
    <bpmn:sequenceFlow id="SequenceFlow_1ksy9yn" name="Maxium attempts excededÂ " sourceRef="ExclusiveGateway_0dg8j7s" targetRef="EndEvent_05sxzwo">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{attemptsMade &gt;= maxAttempts}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_1wgbny4" sourceRef="ExclusiveGateway_0j3xqhl" targetRef="BusinessRuleTask_022wx0p">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{decideNextTime &amp;&amp; callCustomerAgain}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_0ehkhir" name="No - next call Time decided" sourceRef="ExclusiveGateway_0j3xqhl" targetRef="IntermediateCatchEvent_0inwbfz">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{!decideNextTime &amp;&amp; callCustomerAgain}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:sequenceFlow id="SequenceFlow_12qv5f6" name="No - need to decide Time" sourceRef="BusinessRuleTask_022wx0p" targetRef="IntermediateCatchEvent_0inwbfz" />
    <bpmn:startEvent id="StartEvent_0j1f2fi">
      <bpmn:extensionElements>
        <camunda:formData>
          <camunda:formField id="maxAttempts" label="How many attempts do we make" type="long" defaultValue="5" />
          <camunda:formField id="ReasonForCall" label="Why Call this customer" type="string" />
          <camunda:formField id="caller" label="Who will make the call" type="string" defaultValue="demo" />
          <camunda:formField id="team" label="What team will make the call" type="string" defaultValue="TeamCool" />
        </camunda:formData>
        <camunda:executionListener event="start">
          <camunda:script scriptFormat="javascript">execution.setVariable('attemptsMade', 0);</camunda:script>
        </camunda:executionListener>
      </bpmn:extensionElements>
      <bpmn:outgoing>SequenceFlow_02utn77</bpmn:outgoing>
    </bpmn:startEvent>
    <bpmn:sequenceFlow id="SequenceFlow_02utn77" sourceRef="StartEvent_0j1f2fi" targetRef="UserTask_0c2b2p3" />
    <bpmn:endEvent id="EndEvent_1uoigeo">
      <bpmn:incoming>SequenceFlow_04erksu</bpmn:incoming>
    </bpmn:endEvent>
    <bpmn:sequenceFlow id="SequenceFlow_04erksu" name="Yes" sourceRef="ExclusiveGateway_0j3xqhl" targetRef="EndEvent_1uoigeo">
      <bpmn:conditionExpression xsi:type="bpmn:tFormalExpression">#{not callCustomerAgain}</bpmn:conditionExpression>
    </bpmn:sequenceFlow>
    <bpmn:endEvent id="EndEvent_05sxzwo">
      <bpmn:incoming>SequenceFlow_1ksy9yn</bpmn:incoming>
      <bpmn:errorEventDefinition errorRef="Error_034ehi2" />
    </bpmn:endEvent>
    <bpmn:exclusiveGateway id="ExclusiveGateway_0dg8j7s" name="bla" default="SequenceFlow_1rb16tp">
      <bpmn:incoming>SequenceFlow_19iyyn4</bpmn:incoming>
      <bpmn:outgoing>SequenceFlow_1rb16tp</bpmn:outgoing>
      <bpmn:outgoing>SequenceFlow_1ksy9yn</bpmn:outgoing>
    </bpmn:exclusiveGateway>
    <bpmn:sequenceFlow id="SequenceFlow_1rb16tp" sourceRef="ExclusiveGateway_0dg8j7s" targetRef="ExclusiveGateway_0j3xqhl" />
  </bpmn:process>
  <bpmn:error id="Error_034ehi2" name="MaxAttemptsExceeded" errorCode="MaxAttemptsExceeded" />
  <bpmndi:BPMNDiagram id="BPMNDiagram_1">
    <bpmndi:BPMNPlane id="BPMNPlane_1" bpmnElement="CallCustomerProcess">
      <bpmndi:BPMNShape id="UserTask_0c2b2p3_di" bpmnElement="UserTask_0c2b2p3">
        <dc:Bounds x="74" y="-119" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0j3xqhl_di" bpmnElement="ExclusiveGateway_0j3xqhl" isMarkerVisible="true">
        <dc:Bounds x="499" y="-104" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="447" y="-116" width="60" height="24" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="IntermediateCatchEvent_0inwbfz_di" bpmnElement="IntermediateCatchEvent_0inwbfz">
        <dc:Bounds x="171" y="26" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="147" y="65" width="84" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="BusinessRuleTask_022wx0p_di" bpmnElement="BusinessRuleTask_022wx0p">
        <dc:Bounds x="261" y="4" width="100" height="80" />
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1ahh5de_di" bpmnElement="SequenceFlow_1ahh5de">
        <di:waypoint x="171" y="44" />
        <di:waypoint x="124" y="44" />
        <di:waypoint x="124" y="-39" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="103.5" y="23" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_19iyyn4_di" bpmnElement="SequenceFlow_19iyyn4">
        <di:waypoint x="174" y="-79" />
        <di:waypoint x="350" y="-79" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="262" y="-100" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1ksy9yn_di" bpmnElement="SequenceFlow_1ksy9yn">
        <di:waypoint x="375" y="-104" />
        <di:waypoint x="375" y="-192" />
        <di:waypoint x="700" y="-192" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="444.21875" y="-235" width="85" height="24" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_1wgbny4_di" bpmnElement="SequenceFlow_1wgbny4">
        <di:waypoint x="524" y="-54" />
        <di:waypoint x="524" y="44" />
        <di:waypoint x="361" y="44" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="494" y="-11" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_0ehkhir_di" bpmnElement="SequenceFlow_0ehkhir">
        <di:waypoint x="536" y="-66" />
        <di:waypoint x="536" y="171" />
        <di:waypoint x="189" y="171" />
        <di:waypoint x="189" y="62" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="395.4537313432836" y="121" width="76" height="36" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNEdge id="SequenceFlow_12qv5f6_di" bpmnElement="SequenceFlow_12qv5f6">
        <di:waypoint x="261" y="44" />
        <di:waypoint x="207" y="44" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="404" y="-4" width="83" height="36" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="StartEvent_0j1f2fi_di" bpmnElement="StartEvent_0j1f2fi">
        <dc:Bounds x="-32" y="-97" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="-14" y="-57" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_02utn77_di" bpmnElement="SequenceFlow_02utn77">
        <di:waypoint x="4" y="-79" />
        <di:waypoint x="74" y="-79" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="39" y="-100" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_1uoigeo_di" bpmnElement="EndEvent_1uoigeo">
        <dc:Bounds x="700" y="-97" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="718" y="-57" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_04erksu_di" bpmnElement="SequenceFlow_04erksu">
        <di:waypoint x="549" y="-79" />
        <di:waypoint x="700" y="-79" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="615" y="-100" width="20" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
      <bpmndi:BPMNShape id="EndEvent_1ltodqi_di" bpmnElement="EndEvent_05sxzwo">
        <dc:Bounds x="700" y="-210" width="36" height="36" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="717.9280948851001" y="-170" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNShape id="ExclusiveGateway_0dg8j7s_di" bpmnElement="ExclusiveGateway_0dg8j7s" isMarkerVisible="true">
        <dc:Bounds x="349.6597479614529" y="-104" width="50" height="50" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="368" y="-47" width="15" height="14" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNShape>
      <bpmndi:BPMNEdge id="SequenceFlow_1rb16tp_di" bpmnElement="SequenceFlow_1rb16tp">
        <di:waypoint x="400" y="-79" />
        <di:waypoint x="499" y="-79" />
        <bpmndi:BPMNLabel>
          <dc:Bounds x="449.5" y="-100" width="0" height="12" />
        </bpmndi:BPMNLabel>
      </bpmndi:BPMNEdge>
    </bpmndi:BPMNPlane>
  </bpmndi:BPMNDiagram>
</bpmn:definitions>
